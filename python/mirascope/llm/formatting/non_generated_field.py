"""The `NonGeneratedField` class annotation for marking a field as a call argument."""

from pydantic.fields import FieldInfo


class NonGeneratedField:
    """A marker class for indicating that a field is not generated by the LLM, but manually provided.

    This ensures that the LLM call does not attempt to generate this field. Instead, it
    will populate this field with a value provided at parse time.

    This is useful for colocating e.g. validation of a generated output against and
    input argument (such as the length of an output given a number input).

    Note that `NonGeneratedField` may ONLY be used at the top level of the
    generated `BaseModel`.

    Example:

    ```
    class Book(BaseModel):
        title: Annotated[str, llm.formatting.NonGeneratedField()]
        summary: str


    @llm.call(
        provider_id="openai",
        model_id="openai/gpt-5-mini",
        format=Book,
    )
    def summarize_book(title: str):
        return f"Summarize {title}."

    response = summarize_book("The Name of the Wind")
    book = response.parse({"title": "The Name of the Wind"})
    ```
    """


def is_non_generated_field(field: FieldInfo) -> bool:
    """Check if a field has `NonGeneratedField` metadata.

    Args:
        field: The Pydantic field to check.

    Returns:
        True if the field is marked with `NonGeneratedField`, False otherwise.
    """
    return any(isinstance(m, NonGeneratedField) for m in field.metadata)
