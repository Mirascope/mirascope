{# TEMPLATE_METADATA:
options:
  - async
  - context
#}
{% from "_macros.j2" import context_imports, async_imports, async_prefix, await_prefix, fn_def, main_block %}

{{ context_imports() }}
{{ async_imports() }}
from mirascope import llm

{%- if use_context %}
@dataclass
class UserProfile:
    favorite_author: str
{% endif %}


@llm.call("openai:gpt-4o-mini")
{%- if use_context %}
{{ async_prefix() }}def recommend_book(genre: str, ctx: llm.Context[UserProfile]) -> str:
    return f"Recommend a {genre} book. My favorite author is {ctx.deps.favorite_author}."
{%- else %}
{{ async_prefix() }}def recommend_book(genre: str) -> str:
    return f"Recommend a {genre} book"
{%- endif %}


{{ fn_def("main") }}
{%- if use_context %}
    profile = UserProfile(favorite_author="Brandon Sanderson")
    ctx = llm.Context(deps=profile)
{%- endif %}
{%- if use_context %}
    response: llm.Response = {{ await_prefix() }}recommend_book("fantasy", ctx=ctx)
{%- else %}
    response: llm.Response = {{ await_prefix() }}recommend_book("fantasy")
{%- endif %}
    print(response.content)


{{ main_block() }}
